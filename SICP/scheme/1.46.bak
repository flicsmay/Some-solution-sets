#lang planet neil/sicp

(define (iterative-improve good-enough? improve-guess)
  (lambda (guess x)
    
    (define (inner-loop guess)
      (if (good-enough? guess x)
          guess
          (inner-loop (improve-guess guess x))))
    
    (inner-loop guess)))

; iterative improve

(define (sqrt-iter guess x)
  
  (define (good-enough? guess x)
    (< (abs (- (* guess guess) x)) 0.001))
  
  (define (improve guess x)
    (/ (+ guess
          (/ x guess))
       2))
  
  ((iterative-improve good-enough? improve) guess x))

(define (sqrt x)
  (sqrt-iter 1.0 x))

; sqrt

(define (fixed-point f first-guess)
  
  (define tolerance 0.00001)
  
  (define (close-enough? guess x)
    (let ((compares (f guess)))
      (< (abs (- guess compares)) tolerance)))
  
  (define (try guess x)
    (f guess))
  
  ((iterative-improve close-enough? try) first-guess))